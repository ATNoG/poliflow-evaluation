apiVersion: serving.knative.dev/v1
kind: Service
metadata:
  name: function
  namespace: invocation
spec:
  template:
    metadata:
      annotations:
        autoscaling.knative.dev/min-scale: "1"
        autoscaling.knative.dev/max-scale: "1"
        qpoption.knative.dev/flow-config-allowed_json_flows: |-
          [{"type": "sequence", "value": [{"type": "event", "value": {"name": "triggerEvent", "source": "entry-point", "type": "http.request.received", "kind": "consumed"}}, {"type": "function:expression", "value": null}, {"type": "function:knative", "value": {"operation": "f1"}}, {"type": "event", "value": {"trigger": {"name": "uploadPhoto", "type": "photo.database.upload", "kind": "produced"}, "result": {"name": "newPhoto", "source": "database-dummy", "type": "photo.database.new", "kind": "consumed"}}}, {"type": "function:knative", "value": {"operation": "f4"}}, {"type": "function:knative", "value": {"operation": "f5"}}, {"type": "event", "value": {"trigger": {"name": "verification", "type": "info.database.verification", "kind": "produced"}, "result": {"name": "resultVerification", "source": "database-dummy", "type": "info.database.result", "kind": "consumed"}}}, {"type": "function:knative", "value": {"operation": "f7"}}, {"type": "function:knative", "value": {"operation": "f6"}}, {"type": "function:knative", "value": {"operation": "f8"}}, {"type": "event", "value": {"trigger": {"name": "client", "type": "info.database.client", "kind": "produced"}, "result": {"name": "resultClient", "source": "database-dummy", "type": "info.database.resultClient", "kind": "consumed"}}}, {"type": "parallel", "value": [{"type": "sequence", "value": [{"type": "function:knative", "value": {"operation": "f9"}}]}, {"type": "sequence", "value": [{"type": "function:knative", "value": {"operation": "f10"}}]}, {"type": "sequence", "value": [{"type": "function:knative", "value": {"operation": "f11"}}]}]}, {"type": "function:expression", "value": null}, {"type": "parallel", "value": [{"type": "sequence", "value": [{"type": "function:knative", "value": {"operation": "function-b"}}, {"type": "function:knative", "value": {"operation": "function-c"}}], "loop": true}]}, {"type": "function:expression", "value": null}]}]
        qpoption.knative.dev/flow-activate: enable
    spec:
      containers:
        - image: ghcr.io/atnog/poliflow-evaluation/invocation/sample-function
